<!doctype html><html lang=ja dir=ltr><head><title>AWS SAMを使ってみる :: Jot down for myself - Technical notes on AWS, Go, React, etc.</title>
<meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="AWS SAMとは Github : AWS Serverless Application Model (AWS SAM) The goal of AWS SAM is to define a standard application model for serverless applications. This GitHub project is the starting point for AWS SAM, and contains general information, information about the model, and examples of common applications. 日本語訳 AWS SAMの目標は、サーバレス"><meta name=keywords content="aws,golang,react,typescript,mysql"><meta name=robots content="noodp"><meta property="og:url" content="https://techteco.github.io/2018/01/27/lambda-go-sample-sam/"><meta property="og:site_name" content="Jot down for myself"><meta property="og:title" content="AWS SAMを使ってみる"><meta property="og:description" content="AWS SAMでLambdaに簡単にデプロイしてみる"><meta property="og:locale" content="ja"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2018-01-27T22:00:00+09:00"><meta property="article:modified_time" content="2024-05-24T16:04:29+09:00"><meta property="article:tag" content="Lambda"><meta property="article:tag" content="Sam"><meta property="article:tag" content="Aws Cli"><meta property="article:tag" content="Cloudformation"><meta name=twitter:card content="summary"><meta name=twitter:title content="AWS SAMを使ってみる"><meta name=twitter:description content="AWS SAMでLambdaに簡単にデプロイしてみる"><link rel=canonical href=https://techteco.github.io/2018/01/27/lambda-go-sample-sam/><link rel="shortcut icon" href=/favicon.ico><link rel=stylesheet href=/css/index.min.5d96433bd17079764d5a8866addd6d7848ea8295977a06688f43c5be97af544e.css><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","author":{"@type":"Person","name":"TechTeco"},"dateModified":"2024-05-24T16:04:29+09:00","datePublished":"2018-01-27T22:00:00+09:00","description":"AWS SAMとは Github : AWS Serverless Application Model (AWS SAM) The goal of AWS SAM is to define a standard application model for serverless applications. This GitHub project is the starting point for AWS SAM, and contains general information, information about the model, and examples of common applications. 日本語訳 AWS SAMの目標は、サーバレス","name":"AWS SAMを使ってみる","url":"https://techteco.github.io/2018/01/27/lambda-go-sample-sam/"}</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-ML7QTSL8BR"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-ML7QTSL8BR")</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2458671576041251" crossorigin=anonymous></script></head><body class="flex flex-col min-h-screen w-full bg-slate-50 dark:bg-gray-800"><header class="flex flex-none justify-center z-10"><div class="flex flex-row gap justify-between w-full max-w-4xl lg:max-w-5xl h-12 mt-3"><div class="flex-none ml-2 md:ml-0"><a href=/><img class="h-12 w-12 rounded-full" src=/images/button-305726_1280.png alt=logo></a></div><div class=flex-1></div><div class=flex-none></div><div class="flex-none mx-1"></div><div class="flex-none md:hidden"><a href=/search/ class="inline-flex items-center p-2 text-sm text-slate-800 dark:text-slate-200 rounded-lg" aria-controls=navbar-menu aria-expanded=false><span class=sr-only></span>
<i class="w-8 h-8"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M10 10m-7 0a7 7 0 1014 0A7 7 0 103 10"/><path d="M21 21l-6-6"/></svg></i></a></div><div class="darkmode-toggle flex flex-none mr-2 md:mr-0"><label for=darkmode-toggle class="flex items-center px-3 cursor-pointer rounded-full bg-gray-100 dark:bg-gray-600" title><input name=darkmode-toggle id=darkmode-toggle type=checkbox class="sr-only peer" aria-label><div class="group flex flex-row gap-1 justify-center h-8 px-1 rounded-full bg-white dark:bg-gray-700"><i class="h-6 w-6 flex-none rounded-full bg-yellow-400 place-self-center peer-checked:group-[]:invisible"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brightness-down" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 12m-3 0a3 3 0 106 0 3 3 0 10-6 0"/><path d="M12 5v.01"/><path d="M17 7v.01"/><path d="M19 12v.01"/><path d="M17 17v.01"/><path d="M12 19v.01"/><path d="M7 17v.01"/><path d="M5 12v.01"/><path d="M7 7v.01"/></svg>
</i><i class="h-6 w-6 flex-none rounded-full place-self-center invisible peer-checked:group-[]:visible"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-moon-stars" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 3c.132.0.263.0.393.0a7.5 7.5.0 007.92 12.446A9 9 0 1112 2.992z"/><path d="M17 4a2 2 0 002 2 2 2 0 00-2 2 2 2 0 00-2-2 2 2 0 002-2"/><path d="M19 11h2m-1-1v2"/></svg></i></div></label></div></div></header><main class="flex flex-auto justify-center"><div class="w-full max-w-4xl lg:max-w-5xl"><div class="flex flex-col mt-6 mx-2 md:mx-0 rounded-lg overflow-hidden shadow-md bg-white dark:bg-gray-700"><div><a href=/2018/01/27/lambda-go-sample-sam/></a></div><div class="flex flex-col gap-y-3 p-6"><h1 class="text-4xl font-semibold text-slate-800 dark:text-slate-100"><a href=/2018/01/27/lambda-go-sample-sam/>AWS SAMを使ってみる</a></h1><h2 class="my-4 text-large text-slate-600 dark:text-slate-300">AWS SAMでLambdaに簡単にデプロイしてみる</h2><ul class="flex flex-row flex-wrap text-slate-500 dark:text-slate-300"><li><a href=/categories/aws/ class="text-sm mr-2 px-2 py-1 rounded border border-emerald-800 bg-emerald-800 text-slate-50">AWS</a></li><li><a href=/categories/go/ class="text-sm mr-2 px-2 py-1 rounded border border-emerald-800 bg-emerald-800 text-slate-50">GO</a></li><li><a href=/tags/lambda/ class="flex flex-row text-sm mr-2 py-1"><i class="h-5 w-5 flex-none"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 9h14"/><path d="M5 15h14"/><path d="M11 4 7 20"/><path d="M17 4l-4 16"/></svg>
</i><span class=ml-0>Lambda</span></a></li><li><a href=/tags/sam/ class="flex flex-row text-sm mr-2 py-1"><i class="h-5 w-5 flex-none"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 9h14"/><path d="M5 15h14"/><path d="M11 4 7 20"/><path d="M17 4l-4 16"/></svg>
</i><span class=ml-0>sam</span></a></li><li><a href=/tags/aws-cli/ class="flex flex-row text-sm mr-2 py-1"><i class="h-5 w-5 flex-none"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 9h14"/><path d="M5 15h14"/><path d="M11 4 7 20"/><path d="M17 4l-4 16"/></svg>
</i><span class=ml-0>aws cli</span></a></li><li><a href=/tags/cloudformation/ class="flex flex-row text-sm mr-2 py-1"><i class="h-5 w-5 flex-none"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 9h14"/><path d="M5 15h14"/><path d="M11 4 7 20"/><path d="M17 4l-4 16"/></svg>
</i><span class=ml-0>cloudformation</span></a></li></ul><div class="flex flex-col gap-y-1 md:flex-row md:gap-y-0 md:gap-x-4 text-slate-500 dark:text-slate-300"><div class="flex flex-row text-base gap-x-1"><i class="h-6 w-6 flex-none"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 7a2 2 0 012-2h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V7z"/><path d="M16 3v4"/><path d="M8 3v4"/><path d="M4 11h16"/><path d="M11 15h1"/><path d="M12 15v3"/></svg>
</i><time datetime=2018-01-27T22:00:00+09:00>2018-01-27</time></div></div><section class="prose prose-slate dark:prose-invert w-full max-w-4xl lg:max-w-5xl mt-6"><h2></h2><aside><nav id=TableOfContents><ul><li><a href=#テンプレート>テンプレート</a></li><li><a href=#package--deploy>package & deploy</a></li><li><a href=#動作確認>動作確認</a></li></ul></nav></aside></section><article class="mt-6 w-full max-w-4xl lg:max-w-5xl prose prose-slate dark:prose-invert prose-quoteless post-content"><h1 id=aws-samとは>AWS SAMとは</h1><p><a href=https://github.com/awslabs/serverless-application-model target=_blank rel=noopener>Github : AWS Serverless Application Model (AWS SAM)</a></p><blockquote><p>The goal of AWS SAM is to define a standard application model for serverless applications.
This GitHub project is the starting point for AWS SAM, and contains general information, information about the model, and examples of common applications.</p></blockquote><p>日本語訳</p><blockquote><p>AWS SAMの目標は、サーバレスアプリケーション用の標準アプリケーションモデルを定義することです。このGitHubプロジェクトは、AWS SAMの出発点であり、一般的な情報、モデルに関する情報、一般的なアプリケーションの例を含んでいます。</p></blockquote><p><a href=https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/transform-aws-serverless.html target=_blank rel=noopener>AWS::Serverless 変換</a></p><p>ここを見る限りだと、</p><p>AWS SAMはCloudformationの拡張で、最終的にはCloudformationのテンプレートに展開されるイメージ。</p><h1 id=やること>やること</h1><p>基本的には、<a href=/2018/01/24/lambda-go-sample/>待望のAWS LambdaのGolang対応！</a>
ここでやったことの、コンソールでの作業をコマンドベースでやろう！ということです。</p><h1 id=サンプル>サンプル</h1><p>Githubにサンプルがあるので、一番シンプルな<a href=https://github.com/awslabs/serverless-application-model/tree/master/examples/2016-10-31/hello_world target=_blank rel=noopener>hello_world</a>
を参考にしてみる。</p><h2 id=テンプレート>テンプレート</h2><ul><li>lambda-go.yaml</li></ul><pre><code class="language-yaml line-numbers">AWSTemplateFormatVersion : &#39;2010-09-09&#39;
Transform: AWS::Serverless-2016-10-31
Description: lambda go sample application.
Resources:
  HelloWorldFunction:
    Type: AWS::Serverless::Function
    Properties:
      Handler: main
      Runtime: go1.x
      CodeUri: &#34;./../../lambda-go-sample/main.zip&#34;
</code></pre><h2 id=package--deploy>package & deploy</h2><p><a href=https://docs.aws.amazon.com/cli/latest/reference/cloudformation/package.html target=_blank rel=noopener>Reference : cloudformation package</a></p><p>ここでは、</p><p>S3のバケットは<a href=/2018/01/25/cloudformation/>AWS CloudformationをAWS CLIから使ってみる</a>
でサンプルで作成済のバケットを使用します。※基本的になんでも良いと思います。</p><pre><code class="language-bash line-numbers">$ aws cloudformation package \
--template-file ./lambda-go.yaml \
--s3-bucket techteco.sample.bucket \
--s3-prefix lambda-go-sample \
--output-template-file packaged-template.yaml
</code></pre><p>ここまでで、S3にpackageがアップロードされています。</p><p>出力された<em><strong>packaged-template.yaml</strong></em>をつかってdeploy</p><p>ちなみに、出力内容はこちら</p><pre><code class="language-yaml line-numbers">AWSTemplateFormatVersion: &#39;2010-09-09&#39;
Description: lambda go sample application.
Resources:
  HelloWorldFunction:
    Properties:
      CodeUri: s3://techteco.sample.bucket/lambda-go-sample/737fd29b764003ecb0a9c10ee290bfd9
      Handler: main
      Runtime: go1.x
    Type: AWS::Serverless::Function
Transform: AWS::Serverless-2016-10-31
</code></pre><p><a href=https://docs.aws.amazon.com/cli/latest/reference/cloudformation/deploy/index.html target=_blank rel=noopener>Reference : cloudformation deploy</a></p><pre><code class="language-bash line-numbers">$ aws cloudformation deploy \
--template-file packaged-template.yaml \
--stack-name sampleSamLambdaGo \
--capabilities CAPABILITY_IAM
</code></pre><h2 id=動作確認>動作確認</h2><p>まずは、Cloudformationのstackの中身</p><pre><code class="language-bash line-numbers">$ aws cloudformation describe-stack-resources \
--stack-name sampleSamLambdaGo \
| jq .
</code></pre><pre><code class="language-json line-numbers">{
  &#34;StackResources&#34;: [
    {
      &#34;StackName&#34;: &#34;sampleSamLambdaGo&#34;,
      &#34;StackId&#34;: &#34;arn:aws:cloudformation:ap-northeast-1:123456789012:stack/sampleSamLambdaGo/28efadc0-088c-11e8-b769-50a68a175a82&#34;,
      &#34;LogicalResourceId&#34;: &#34;HelloWorldFunction&#34;,
      &#34;PhysicalResourceId&#34;: &#34;sampleSamLambdaGo-HelloWorldFunction-YAWCC305TVCA&#34;,
      &#34;ResourceType&#34;: &#34;AWS::Lambda::Function&#34;,
      &#34;Timestamp&#34;: &#34;2018-02-03T02:46:15.113Z&#34;,
      &#34;ResourceStatus&#34;: &#34;CREATE_COMPLETE&#34;
    },
    {
      &#34;StackName&#34;: &#34;sampleSamLambdaGo&#34;,
      &#34;StackId&#34;: &#34;arn:aws:cloudformation:ap-northeast-1:123456789012:stack/sampleSamLambdaGo/28efadc0-088c-11e8-b769-50a68a175a82&#34;,
      &#34;LogicalResourceId&#34;: &#34;HelloWorldFunctionRole&#34;,
      &#34;PhysicalResourceId&#34;: &#34;sampleSamLambdaGo-HelloWorldFunctionRole-1HGTSQ58UEK91&#34;,
      &#34;ResourceType&#34;: &#34;AWS::IAM::Role&#34;,
      &#34;Timestamp&#34;: &#34;2018-02-03T02:46:09.876Z&#34;,
      &#34;ResourceStatus&#34;: &#34;CREATE_COMPLETE&#34;
    }
  ]
}
</code></pre><p>正しく実行されればOK!</p><pre><code class="language-bash line-numbers">$ aws lambda invoke \
--invocation-type Event \
--function-name sampleSamLambdaGo-HelloWorldFunction-YAWCC305TVCA \
--payload &#39;{&#34;name&#34;: &#34;テスト太郎&#34;}&#39; \
outputfile.txt
</code></pre></article></div></div></div></main><footer class="flex flex-none justify-center"><section class="flex flex-col md:flex-row mx-2 md:mx-0 gap-2 md:gap-0 justify-between w-full max-w-4xl lg:max-w-5xl py-6 text-slate-500 dark:text-slate-300"><div class="flex flex-row"></div><div class=grow></div><div class="flex flex-row"></div></section></footer><script src=/main.min.c6372b6836971865bd94bfde974748aca8415824a2facab6ccd66a87384bfacb.js></script><div class="hidden top-1 right-1" id=code-copy><i class="h-6 w-6 block"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667A2.667 2.667.0 019.667 7h8.666A2.667 2.667.0 0121 9.667v8.666A2.667 2.667.0 0118.333 21H9.667A2.667 2.667.0 017 18.333z"/><path d="M4.012 16.737A2.005 2.005.0 013 15V5c0-1.1.9-2 2-2h10c.75.0 1.158.385 1.5 1"/></svg></i></div><div class="hidden top-1 right-1" id=code-copy-done><i class="h-6 w-6 block"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-check" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 12l5 5L20 7"/></svg></i></div><script src=/code-copy.min.e7b2a74adef1ed474c335c8bd5e7832b2316b8842b0f9184d65286c5bd64f51a.js></script></body></html>